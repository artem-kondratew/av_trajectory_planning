ARG distro_image
ARG ROS_DISTRO

FROM osrf/ros:humble-desktop-full

# workspace setup

ENV WS=/workspace

RUN echo "source /opt/ros/${ROS_DISTRO}/setup.bash" >> ~/.bashrc
RUN echo "source ${WS}/install/setup.bash" >> ~/.bashrc
RUN echo "alias s='. ./install/setup.bash'" >> ~/.bashrc
RUN echo "alias l='clear'" >> ~/.bashrc
RUN echo "alias record='bash /record.sh'" >> ~/.bashrc

# ROS2 pkgs installation

RUN apt update -y

RUN DEBIAN_FRONTEND=noninteractive apt install -y python3-venv python3-pip
RUN DEBIAN_FRONTEND=noninteractive apt install -y vim nano
RUN DEBIAN_FRONTEND=noninteractive apt install -y iputils-ping

RUN DEBIAN_FRONTEND=noninteractive apt install -y python3-colcon-common-extensions

RUN DEBIAN_FRONTEND=noninteractive apt install -y ros-${ROS_DISTRO}-plotjuggler-ros

RUN python3 -m pip install carla==0.9.16 transforms3d

# Eigen installation

RUN DEBIAN_FRONTEND=noninteractive apt install -y libeigen3-dev

# OSQP installation

RUN git clone --recursive https://github.com/osqp/osqp.git && \
    mkdir osqp-build && \
    cmake -S osqp -B osqp-build -DCMAKE_BUILD_TYPE=Release && \
    cmake --build osqp-build --parallel && \
    cmake --build osqp-build --target install

RUN git clone --recursive https://github.com/robotology/osqp-eigen.git && \
    mkdir eigen-osqp-build && \
    cmake -S osqp-eigen -B eigen-osqp-build -DCMAKE_BUILD_TYPE=Release && \
    cmake --build eigen-osqp-build --parallel && \
    cmake --build eigen-osqp-build --target install
